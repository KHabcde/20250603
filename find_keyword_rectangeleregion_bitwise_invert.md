
---

# ✅ 要件定義書：OCRによる矩形領域内のキーワード座標特定モジュール

## 1. モジュール名

**`find_keyword_rectangleregion_bitwise_invert`**

## 2. 概要

この関数は、PC画面の指定された矩形領域内から、指定されたキーワード（文字列）をOCRにより検出し、そのキーワードが存在する座標を返すモジュールである。OCR処理にはTesseractを用い、文字認識の精度を高めるために画像処理と領域変位による冗長解析を行う。

## 3. 想定用途

* UI要素の文字認識と位置特定
* 画面上のキーワードベース操作支援
* 自然言語PC操作自動化システムへの統合モジュール

## 4. 関数定義

```python
def find_keyword_rectangleregion_bitwise_invert(arg1, arg2, arg3, arg4, arg5):
    ...
```

### 引数仕様（入力）

| 引数     | 説明             |
| ------ | -------------- |
| `arg1` | 探したいキーワード（文字列） |
| `arg2` | 矩形領域の左上x座標     |
| `arg3` | 矩形領域の左上y座標     |
| `arg4` | 矩形領域の右下x座標     |
| `arg5` | 矩形領域の右下y座標     |

### 戻り値（出力）

* 指定の文字列が見つかった場合：キーワードの中央座標 `(x, y)`（整数のタプル）
* 見つからなかった場合：`None`

## 5. 処理フロー

1. **画面キャプチャの取得**

   * 指定された `(arg2,arg3)` ～ `(arg4,arg5)` の矩形領域のスクリーンショットを取得する。

2. **画像前処理**

   * 切り出した画像をグレースケールに変換。
   * 二値化処理を実施（白背景黒文字向け）。
   * 上記を反転処理し、黒背景白文字にも対応。

3. **OCR実行：5通りの領域に対して分析**

   * 元の領域。
   * 上に1ピクセルずらした領域。
   * 下に1ピクセルずらした領域。
   * 左に1ピクセルずらした領域。
   * 右に1ピクセルずらした領域。

4. **OCR統合処理**

   * 各領域ごとに通常・反転の2パターンでOCRを実行（合計10回）。
   * `pytesseract.image_to_data()` を使って文字ごとの位置情報を取得。

5. **文字列マッチングと座標抽出**

   * 各OCR結果に対して `arg1` を完全一致 or 前方一致などで照合。
   * 一致した単語の座標のバウンディングボックスを取得し、その中心座標を計算。

6. **最終出力の決定**

   * 最初に見つけた候補、もしくは最も信頼度の高い候補を返す（候補が複数ある場合は柔軟に設計）。

## 6. 使用技術・ライブラリ

* `pytesseract`（Tesseract OCR Pythonバインディング）
* `opencv-python`（画像前処理・領域切り出し）
* `PIL`（画像の切り出しおよびモノクロ処理）

## 7. 注意事項

* Tesseractのパス設定が必要な環境では適切に `pytesseract.pytesseract.tesseract_cmd` を設定すること。
* モノクロ反転時には `cv2.bitwise_not()` を使用。
* 矩形領域のずらしは画像サイズ外にならないようクリッピング処理を含める。

---


